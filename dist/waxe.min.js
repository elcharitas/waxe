(function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Wax=e()})(function(){return function n(i,o,u){function c(t,e){if(!o[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(s)return s(t,!0);throw(r=Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",r}r=o[t]={exports:{}},i[t][0].call(r.exports,function(e){return c(i[t][1][e]||e)},r,r.exports,n,i,o,u)}return o[t].exports}for(var s="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.absolutePath=t.WaxDelimiter=t.WaxTemplate=t.WaxConfig=void 0;var u=o("../debug");function r(t,e){void 0===e&&(e=Object.keys(t));var r={writable:!1,configurable:!1};return e.forEach(function(e){Object.defineProperty(t,e,r)}),t}function c(e,t){var r;for(void 0===t&&(t="/"),r=e,""===(t=t)&&(t="/"),~t.indexOf("/")||(t+="/path"),e=!r.indexOf(t)||r.match(/^(\/|\w)/)?r:(r="./"==r.substring(0,2)?"/."+r:("/"===t&&(t="/path"),"/../"+r),t+r);/\/\.\.\//.test(e=e.replace(/[^/]*\/+\.\.\//g,"")););return e=e.replace(/\.$/,"").replace(/\/\./g,"").replace(/"/g,"%22").replace(/'/g,"%27").replace(/</g,"%3C").replace(/>/g,"%3E")}t.absolutePath=c;function s(){return""}t.WaxTemplate=s;var n=r({blockSyntax:/@(\w+)(\([^@]+\))?/,tagName:1,argList:2,endPrefix:"end"},["endPrefix"]),n={strip:!0,debug:!1,autoescape:!0,delimiter:t.WaxDelimiter=n,context:r({__env:{},startTime:Date.now(),json:JSON.stringify,now:Date.now,escape:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"};return"string"==typeof e?e.replace(/&(?!#?\w+;)|<|>|"|'|\//g,function(e){return t[e]||e}):e},merge:function(e){var r=this;void 0===e&&(e=[]),(e=[].slice.call(e)).forEach(function(e){for(var t in e)t in r&&!0!==Object.getOwnPropertyDescriptor(r,t).configurable||(r[t]=e[t])})},reverse:function(e,t){return void 0===t&&(t=""),e.split(t).reverse().join(t)},template:function(e,t,r){void 0===t&&(t={});var n=this.id,i=o("../waxe").template(c(e,n));!0===r||i||u.debug("no template: "+e+"!",i,s),this.id=e;t=(i||s)(t);return this.id=n,t}})};t.WaxConfig=n},{"../debug":4,"../waxe":8}],2:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.parseTemplate=s.parseString=s.traverseNode=s.out=void 0;var a=e("."),p=e("../debug"),l=e("./walker");s.out="out";var f=JSON.stringify;function n(e,t,r){var n,i,o,u,c,t=(n=t,i=r.delimiter,o=i.argList,u=i.blockSyntax,c=i.tagName,t=i.endPrefix,i=f(n),n=i.match(RegExp(u,"g")),{text:i,directives:n,argList:o,blockSyntax:u,tagName:c,endPrefix:t}),e=new(p.extendProp(l.Walker,t))(e).walk();return!0===r.strip&&(e=e.replace(/\\n\s+/g,"")),function(e){var t=a.WaxTemplate;try{t=Function(s.out,"this.merge(arguments);"+s.out+"+="+e+";return "+s.out)}catch(e){throw"Wax"+e}return t}(e)}function u(e,t,r){var e=e.split(""),i=null;return e.forEach(function(e,t,r,n){void 0===n&&(n=r[t+1]),!i&&e.match(/["']/)?i=e:i===e?i=null:i||"$"!==e||"["==n?i||"$"!==e||"["!==n?i||";"!==e?i||"#"!==e||"["!==n||(e="arguments"):(n=r[t-3]+r[t-2]+r[t-1]).match(/^&(g|l)t$/)&&(r[t-1]=r[t-2]=r[t-3]="",e=n.replace("&gt",">").replace("&lt","<")):e="this":e="this.",r[t]=e}),!0===r?"new Function("+f("return "+e.join(""))+").apply(this,["+(t?t.text():"")+"]);":e.join("")}s.traverseNode=function(e,t){var r=t.tag,n=t.argLiteral,i=t.configs,o=e.parser.getTag(t),t="";if(null!==o)o.write=function(e){return s.out+"+="+o.exec(e)},o.exec=function(e,t){return void 0===t&&(t=!0),u(e,n,t)},t=o.descriptor.call(o,n);else if(~e.jsTags.indexOf(r))t=r+n.parse()+"{";else if(e.isBlockEnd(r))t="}";else if(i.debug)throw'WaxNodeError: Unknown Tag "'+r+'"';return t},s.parseString=u,s.parseTemplate=function(e,t,r){return void 0===e&&(e="waxe-"+Date.now()),void 0===t&&(t=""),e=e,t=n(r,t,r.getConfigs()),r=r,Function("call,tpl","return tpl["+f(e)+"]=function(){return call(this,arguments)}")(Function.apply.bind(t.bind(r.getConfigs().context,"")),{})}},{".":1,"../debug":4,"./walker":3}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Walker=void 0;var a=e("./parser"),e=(n.prototype.walk=function(){var e,u=this,c=this.text,s="";return null!==(e=this.directives)&&void 0!==e&&e.forEach(function(e,t){var r=JSON.parse('"'+e+'"'),n=r.match(u.blockSyntax),i=n[u.tagName],o=n[u.argList],n=void 0===o?"":o,o=u.parser.getConfigs(),n=u.toArgs(n);if("extends"===i&&0===t)return s=a.parseString("+$template("+n+")"),c=c.replace(e,"");c=c.replace(e,'";'+a.traverseNode(u,{tag:i,argLiteral:n,block:r,position:t,configs:o,context:o.context})+"\n"+a.out+'+="')}),c+s},n.prototype.isBlockEnd=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=e.replace(this.endPrefix,"")),0==e.indexOf(this.endPrefix)&&(!!~this.jsTags.indexOf(t)||null!==this.parser.getTag({tag:t}))},n.prototype.toArgs=function(e){var t=new String(e);return t.arg=function(e){return"["+t.text()+"]["+e+"]"},t.parse=function(){return a.parseString(t)},t.text=function(){return t.parse().replace(/^\(([\s\S]*)\)$/,"$1")},t},n);function n(e){this.jsTags=["for","if","while","switch"],this.parser=e}r.Walker=e},{"./parser":2}],4:[function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])!{}.hasOwnProperty.call(t,i)||(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),r.debug=r.extendProp=void 0;var u=["%1 should be %2 as %3","%1 should be %3 as a %2"],c=TypeError;r.extendProp=function(e,t){return Object.defineProperty(e,"prototype",{value:n(n({},e.prototype),t.prototype||t)}),e},r.debug=function(e,t,r){void 0===r&&(r={});var n,r=(i=[e],typeof(n=t)!=(r=typeof(t=r))&&i.push((null===t||void 0===t?void 0:t.name)||r),void 0===n&&"object"==r?i.push("initialized"):("object"!=r||null===t&&null!==n)&&(i.push(r),i.push("declared")),i),i=u[r.length-2],o=void 0===i?e:i;if(r.forEach(function(e,t){o=o.replace("%"+(t+1),e)}),1<r.length)throw new c(o)}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CoreDirectives=void 0;var n=(i.prototype.set=function(){return this.exec('eval(#[0]+"="+$escape($json(#[1])));')},i.prototype.define=function(){return this.exec("$[#[0]]=#[1];")},i.prototype.section=function(e){return this.exec("$__super=$__env["+e+"]||new Function('s','return s()');var _block=$__env["+e+"]=$__super.bind(this,function(s,_block){var out='';",!1)},i.prototype.endsection=function(){return this.exec("return out});delete _block",!1)},i.prototype.show=function(){return 0<this.argLiteral.length?this.write("$__env[#[0]].bind(this)()"):this.exec("return out});out+=_block.bind(this)();delete _block",!1)},i.prototype.macro=function(){return this.exec('$[#[0]]=(function(){var name=#[0];var call=$[name];var args=[].slice.call(arguments);var out = "";',!1)},i.prototype.endmacro=function(){return"return out;}).bind(this)"},i.prototype.include=function(){return this.write("$template(#[0],#[1])")},i.prototype.yield=function(){return this.write("("+this.configs.autoescape+"?$escape:String)(#[0]||#[1])")},i.prototype.elseif=function(e){return"}else if("+e+"){"},i.prototype.else=function(){return"}else{"},i.prototype.switch=function(e){return"switch"+e+"{/*"},i.prototype.case=function(e){return"*/case "+e+":"},i.prototype.break=function(e){return 0===e.length?"break/*":"if("+e.text()+"){break}"},i.prototype.continue=function(e){return"if("+(e.text()||0==e.length)+"){continue}"},i.prototype.endswitch=function(){return"*/}"},i.prototype.forelse=function(e){return"var loopObj="+e.text().split(/\s+/)[2]+";for"+e+"{"},i.prototype.empty=function(){return'} if(typeof loopObj!=="object"||Object.keys(loopObj).length<1){'},i.prototype.endforelse=function(){return"};delete loopObj;"},i);function i(){}r.CoreDirectives=n},{}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CoreWax=void 0;var n=e("../debug"),i=e("./core"),o=e("./misc"),e=function(){this.directives=new(n.extendProp(i.CoreDirectives,o.MiscDirectives.prototype))};r.CoreWax=e},{"../debug":4,"./core":5,"./misc":7}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MiscDirectives=void 0;var n=(i.prototype.comment=function(){},i.prototype.parent=function(){return this.write("($__super||String)()")},i.prototype.includeIf=function(){return this.write("$template(#[0],#[1],!0)")},i.prototype.includeWhen=function(){return this.write("#[0]?$template(#[1],#[2]):''")},i.prototype.escape=function(){return this.write("$escape(#[0]||#[1])")},i.prototype.json=function(e){return this.write("$json"+e)},i.prototype.js=function(){return"var hjs=out;"},i.prototype.endjs=function(){return this.exec('hjs=$reverse(out).replace($reverse(hjs),"");out=$reverse($reverse(out).replace(hjs,""));(new Function($reverse(hjs))).bind(this)();delete hjs')},i.prototype.bind=function(){return this.write('$["bind"+#[0]]=#[1];setInterval(function(){document.querySelectorAll(#[0]).forEach(function(hook){if($["bind"+#[0]]!==#[1]){hook.value = this["bind"+#[0]]=#[1]}})})')},i);function i(){}r.MiscDirectives=n},{}],8:[function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])!{}.hasOwnProperty.call(t,i)||(e[i]=t[i]);return e}).apply(this,arguments)},i=e("./debug"),o=e("./compiler"),u=e("./compiler/parser"),c=e("./plugins");function s(){i.debug("Wax",this),i.debug("Wax",s._core,null),this.configs=o.WaxConfig,this.tags={},this.templates={}}t.exports=(s.global=function(e,t){return this.core.configs.context[e]=t},s.directive=function(e,t){return this.core.tags[e]={tag:e,descriptor:t}},s.template=function(e,t){return"string"==typeof t?this.core.templates[e]=u.parseTemplate(e,t,s):this.global("id",e),this.core.templates[e]},s.resolve=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r=!0),"undefined"!=typeof document&&document.querySelectorAll(e).forEach(function(e){e.innerHTML=e.value=s.template(e.id,e.value||e.innerHTML)(t),"hidden"in e&&(e.hidden=!r)})},Object.defineProperty(s,"core",{get:function(){return this._core instanceof s||(this._core=new s,s.addPlugin(c.CoreWax)),this._core},enumerable:!1,configurable:!0}),s.setDelimiter=function(e){return s.core.configs.delimiter=n(n({},s.getDelimiter()),e)},s.setConfig=function(e,t){return s.core.configs[e]=t},s.getConfigs=function(){return s.core.configs},s.getDelimiter=function(){return s.getConfigs().delimiter},s.getTag=function(e){var t=this.core.tags[e.tag]||null;return"object"==typeof t&&null!==t&&(t=n(n({},t),e)),t},s.addPlugin=function(e){var t,e=new e(this).directives,r=void 0===e?{}:e;for(t in r)"function"==typeof r[t]&&this.directive(t,r[t])},(t=s)._core=null,t)},{"./compiler":1,"./compiler/parser":2,"./debug":4,"./plugins":6}]},{},[8])(8)});